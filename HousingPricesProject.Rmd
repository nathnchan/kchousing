---
ztitle: "HousingPricesProject"
author: "Nathan Chan"
date: "2023-09-13"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Reading in Data and Setting up}
housing <- read.csv("kc_housing.csv", stringsAsFactors = TRUE)
```

This data set includes the following variables:

- `id`: unique ID
- `date`: date of the sale
- `price`: selling price of the house
- `bedrooms`: number of bedrooms
- `bathrooms`: number of bathrooms 
- `living`: size of the interior living space (in square feet)
- `lot`: size of the lot (in square feet)
- `floors`: number of floors
- `waterfront`: is the housing located on the waterfront? (yes or no)
- `view`: a *numeric* rating of 1 to 5 for the quality of the view (higher = better)
- `condition`: the condition of the house (neutral, good, or great)
- `above`: size of the interior living space above ground level (in square feet)
- `basement`: size of the interior living space below ground level (in square feet)
- `year`: original year of construction
- `zipcode`: zip code
- `living15`: average size of the interior living space for the 15 nearest neighbors (in square feet)
- `lot15`: average size of the lot for the 15 nearest neighbors (in square feet)
- `renovated`: was the house renovated in the previous 25 years? (yes or no)

```{r Libraries}
library("car")
library("ggmap")
library("ggplot2")
library("mapdata")
library("maps")
library("dplyr")
library("ggthemes")
```


```{r Washington State Map}
states <- map_data("state")
head(states)

wa_df <- subset(states,region%in%"washington")

counties <- map_data("county")
wa_county <- subset(counties, region == "washington")
wa_base <- ggplot(data = wa_df, mapping = aes(x = long, y = lat, group = group)) +
  coord_fixed(1.3) +
  geom_polygon(color = "black", fill = "grey")

kcmap <- wa_base + theme_nothing() +
  geom_polygon(data = wa_county, fill = NA, color = "white") +
  geom_polygon(color = "black", fill = NA)  # get the state border back on top

king_county <- subset(wa_county, subregion == "king")

wa_base + theme_void() +
geom_polygon(data = wa_county, fill = NA, color = "white") +
geom_polygon(color = "black", fill = NA) +
geom_polygon(data = king_county, fill = "mediumslateblue", color = "white")
```

```{r Creation of a Scatterplot Matrix of the Dataset}
pairs(housing[,c("price", "lot", "basement", "living", "living15", "lot15")])
pairs(housing[,c("price", "bedrooms", "bathrooms", "view", "waterfront", "zipcode")])
pairs(housing[,c("price", "above", "floors", "bedrooms", "bathrooms")])
pairs(housing[,c("price", "condition", "renovated")])
```

```{r Price per Zipcode}
length(unique(housing$zipcode))
zipcode_prices <- housing%>%select("price", "zipcode")
price_per_zipcode <- zipcode_prices%>%group_by(zipcode)%>%summarise(avghouseprice
                                                                    = mean(price))
price_per_zipcode_ordered <- price_per_zipcode%>%arrange(desc(avghouseprice))
head(price_per_zipcode_ordered)
tail(price_per_zipcode_ordered)
```

```{r Histograms}
hist(housing$price,col="mediumslateblue")
hist(housing$lot,col="mediumslateblue")
hist(housing$basement,col="mediumslateblue")
hist(housing$living,col="mediumslateblue")
hist(housing$zipcode,col="mediumslateblue")
hist(housing$bathrooms,col="mediumslateblue")

ggplot(data = housing, aes(x = price, fill = "")) +
  geom_histogram(binwidth = 250000, color = "black") +
  scale_fill_manual(values = "mediumslateblue") +
  labs(title = "Histogram of Price",
       x = "Price",
       y = "Frequency") +
  theme_minimal() +
  theme(panel.grid = element_blank()) +
  scale_x_continuous(labels = scales::number_format(accuracy = 1)) +
  theme_fivethirtyeight() +
  theme(legend.position = "none") +
  theme(axis.title = element_text())

ggplot(data = housing, aes(x = year, fill = "")) +
  geom_histogram(binwidth = 5, color = "black") +
  scale_fill_manual(values = "mediumslateblue") +
  labs(title = "Histogram of Years Constructed",
       x = "Year",
       y = "Frequency") +
  theme_minimal() +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Individual Histograms of log(Variables)}
hist(log(housing$lot),col="mediumslateblue")
hist(log(housing$basement),col="mediumslateblue")
hist(log(housing$living),col="mediumslateblue")
hist(log(housing$price),col="mediumslateblue")
```

```{r Price v. Basement Size}
price_basement_lm <- lm(price ~ basement, data = housing)
r_squared_basement <- summary(price_basement_lm)$r.squared

ggplot(housing, aes(x = basement, y = price)) +
  geom_point() +
  labs(x = "Basement Size", y = "Price") +
  ggtitle("Price vs. Basement Size") +
  scale_y_continuous(labels = scales::comma) +
  geom_smooth(method = "lm", se = FALSE, color = "blueviolet") +
  theme_fivethirtyeight() +
  geom_text(aes(label = paste("R-squared = ", round(r_squared_basement, 2)), x = max(basement), y = min(price)), hjust = 1) +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Price v. Living Room Size of 15 Nearest Neighbors}
ggplot(housing, aes(x = living15, y = price)) +
  geom_point() +
  labs(x = "Living Room Size of 15 Nearest Neighbors", y = "Price") +
  ggtitle("Price vs. Living Room Size of 15 Nearest Neighbors") +
  scale_y_continuous(labels = scales::comma) +
  geom_smooth(method = "gam", se = FALSE, 
              color = "blueviolet") +
  theme(panel.background = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Price v. Number of Bathrooms}
ggplot(housing, aes(x = bathrooms, y = price)) +
  geom_point() +
  labs(x = "Number of Bathrooms", y = "Price") +
  ggtitle("Price vs. Number of Bathrooms") +
  scale_y_continuous(labels = scales::comma) +
  geom_smooth(method = "gam", se = FALSE, 
              color = "blueviolet") +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Price v. Lot Size}
ggplot(housing, aes(x = log(lot), y = price)) +
  geom_point() +
  labs(x = "Log of Lot Size", y = "Price") +
  ggtitle("Price vs. Log of Lot Size") +
  scale_y_continuous(labels = scales::comma) +
  scale_x_continuous(labels = scales::comma) +
  theme_minimal() +
  theme(axis.title.x = element_text(size = 12), axis.title.y = element_text(size = 12)) +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Fixing Basement}
housing3$basement <- housing3$basement + 1
```

```{r Basement Size + Zipcode Area}
custom_colors <- c("mediumslateblue", "darkslateblue")

ggplot(data = housing3, aes(x = basement, fill = zipcodeArea)) +
  geom_histogram(binwidth = 300, color = "black") +
  labs(title = "",
       x = "Basement Sizes in Square Feet",
       y = "Number of Basements",
       fill = NULL) +
  scale_fill_manual(values = custom_colors) +
  theme_minimal() +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(axis.title = element_text())
```


```{r Relating Bathrooms and Bedrooms to Price}
bathroom_price <- housing%>%select(price, bathrooms)
bathroom_price$bathrooms <-as.factor(bathroom_price$bathrooms)

ggplot(bathroom_price, aes(x = bathrooms, y = price)) +
  geom_boxplot(fill = "lightslateblue", color = "black", width = 0.5) +
  labs(title = "Boxplot of Price by Number of Bathrooms", x = "Number of Bathrooms", y = "Price") +
  scale_y_continuous(labels = scales::comma) +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())

bedroom_price <- housing%>%select(price, bedrooms)
bedroom_price$bedrooms <-as.factor(bedroom_price$bedrooms)

ggplot(bedroom_price, aes(x = bedrooms, y = price)) +
  geom_boxplot(fill = "lightslateblue", color = "black", width = 0.5) +
  labs(title = "Boxplot of Price by Number of Bedrooms", x = "Number of Bedrooms", y = "Price") +
  scale_y_continuous(labels = scales::comma) +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Checking for Bathroom and Bedroom Interaction}
summary(lm(price ~ bedrooms * bathrooms, data = housing))
```

```{r Waterfront Presence Adjustment}
no_water_over_million <- housing %>% filter(waterfront == "no", price >= 1000000) %>% group_by(zipcode)%>%summarise(avg_price_no_water_over_million=mean(price)) %>% arrange(desc(avg_price_no_water_over_million))
no_water_over_million
```

```{r Waterfront Boxplot}
ggplot(housing, aes(x = waterfront, y = price)) +
  geom_boxplot(fill = "lightslateblue", color = "black", width = 0.5) +
  labs(title = "Boxplot of Price by Waterfront Presence", x = "Waterfront Presence", y = "Price") +
  scale_x_discrete(labels = c("no" = "Not on Waterfront", "yes" = "On Waterfront")) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme_fivethirtyeight() +
  theme(axis.text.x = element_text(size = 12))
```

```{r Renovation Boxplot}
ggplot(housing, aes(x = renovated, y = price)) +
  geom_boxplot(fill = "lightslateblue", color = "black", width = 0.5) +
  labs(title = "Boxplot of Price by Renovation", x = "Renovation", y = "Price") +
  scale_x_discrete(labels = c("no" = "Not Renovated", "yes" = "Renovated")) +
  scale_y_continuous(labels = scales::comma) +
  theme_minimal() +
  theme_fivethirtyeight() +
  theme(axis.text.x = element_text(size = 12)) +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Price v Year}
price_year_lm <- lm(price ~ year, data = housing)
r_squared_year <- summary(price_year_lm)$r.squared

ggplot(housing, aes(x = year, y = price)) +
  geom_point() +
  labs(x = "Year", y = "Price") +
  ggtitle("Price vs. Year Constructed") +
  scale_y_continuous(labels = scales::comma) +
  geom_smooth(method = "loess", se = FALSE, color = "blueviolet") +
  theme(panel.background = element_blank(), panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank()) +
  geom_text(aes(label = paste("R-squared = ", round(r_squared_year, 2)), x = max(year), 
                y = min(price)), hjust = 1) +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Renovation and Construction Date}
custom_colors <- c("mediumslateblue", "darkslateblue")

ggplot(data = housing, aes(x = year, fill = renovated)) +
  geom_histogram(binwidth = 5, color = "black") +
  labs(title = "Construction Dates of Homes",
       x = "Year",
       y = "Frequency",
       fill = NULL) +
  scale_fill_manual(values = custom_colors, labels = c("no" = "Not Renovated", "yes" = 
                                                         "Renovated")) +
  theme_minimal() +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(axis.title = element_text())
```

```{r Boxplot of Price by View Rating}
view_price <- housing%>%select(price, view)
view_price$view <-as.factor(view_price$view)

ggplot(view_price, aes(x = view, y = price)) +
  geom_boxplot(fill = "lightslateblue", color = "black", width = 0.5) +
  labs(title = "Boxplot of Price by View Rating", x = "View Rating", y = "Price") +
  theme_fivethirtyeight() +
  theme(panel.grid = element_blank()) + 
  theme(legend.position = "none") +
  theme(axis.title = element_text())
```

```{r Zipcode and Lot Size}
housing3$zipcodeArea <- NA

for (i in 1:nrow(housing3)) {
  if (housing3$zipcode[i] %in% c("98177", "98133", "98155", 
                                 "98125", "98117", "98103",
                                 "98115", "98107", "98105",
                                 "98199", "98119", "98109",
                                 "98102", "98112", "98122",
                                 "98121", "98101", "98154",
                                 "98104", "98144", "98134",
                                 "98106", "98126", "98116",
                                 "98136", "98108", "98118",
                                 "98146", "98168", "98178")) {
    housing3$zipcodeArea[i] <- "Downtown Seattle"
  } else {
    housing3$zipcodeArea[i] <- "Other"
  }
}
housing3$zipcodeArea <- as.factor(housing3$zipcodeArea)
housing3
```

```{r First Model}
model1 <-lm(price ~ living + waterfront + basement*zipcodeArea + log(lot) + I(living15^2) + year + bathrooms*bedrooms, data = housing3)
summary(model1)
```
